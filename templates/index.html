{% extends 'base.html' %}

{% block content %}
  <h1 class="text-3xl font-bold text-gray-900 mb-6">Experiment Dashboard</h1>
  
  <div class="space-y-6">
    
    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
      <div class="px-4 py-5 sm:px-6">
        <h2 class="text-lg font-medium text-gray-900">Experiment Results</h2>
        <p class="mt-1 text-sm text-gray-500">Individual experiment outcomes and metrics</p>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Experiment ID</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Timestamp</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Generator</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Strategy</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Benchmark</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Compiles</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Runs Successfully</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Line Cov (%)</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Branch Cov (%)</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cyclomatic Complexity</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Coupling Between Objects</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time (s)</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Token Cost</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Correction Distance (%)</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for exp in experiments %}
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ loop.index }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ exp['experiment_id'] }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ exp['timestamp'] }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ exp['generator_name'] }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ exp['prompt_strategy'] }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ exp['benchmark_name'] }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {% if exp['compiles'] == 1 %}
                  <span class="text-green-600">✓</span>
                {% elif exp['compiles'] == 0 %}
                  <span class="text-red-600">✗</span>
                {% else %}
                  <span class="text-gray-400">-</span>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {% if exp['runs_successfully'] == 1 %}
                  <span class="text-green-600">✓</span>
                {% elif exp['runs_successfully'] == 0 %}
                  <span class="text-red-600">✗</span>
                {% else %}
                  <span class="text-gray-400">-</span>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ '%.2f'|format(exp['line_coverage'] or 0) }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ '%.2f'|format(exp['branch_coverage'] or 0) }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ exp['cyclomatic_complexity'] or 'N/A' }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ exp['coupling_between_objects'] or 'N/A' }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ '%.2f'|format(exp['time_cost'] or 0) }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ exp['token_cost'] or 'N/A' }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {% if exp['correction_distance'] is not none %}
                  <span class="font-medium {% if exp['correction_distance'] < 0.1 %}text-green-600{% elif exp['correction_distance'] < 0.3 %}text-yellow-600{% else %}text-red-600{% endif %}">
                    {{ '%.2f'|format(exp['correction_distance'] * 100) }}%
                  </span>
                {% else %}
                  <span class="text-gray-400">N/A</span>
                {% endif %}
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="15" class="px-6 py-4 text-center text-sm text-gray-500">No experiments found. Run one to get started!</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    {% if statistical_results %}
    <div class="bg-white shadow overflow-hidden sm:rounded-lg">
      <div class="px-4 py-5 sm:px-6">
        <h2 class="text-lg font-medium text-gray-900">Statistical Analysis Results</h2>
        <p class="mt-1 text-sm text-gray-500">Statistical test results and significance analysis</p>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Benchmark</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Metric</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Test Type</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Test Statistic</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">P-Value</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Significant</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sample Size</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Analysis Stage</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for result in statistical_results %}
            <tr>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ result['benchmark_name'] }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ result['metric_name'] }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ result['test_type'] }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ '%.4f'|format(result['test_statistic'] or 0) }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ '%.4f'|format(result['p_value'] or 0) }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {% if result['is_significant'] %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    Yes
                  </span>
                {% else %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                    No
                  </span>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ result['sample_size'] }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ result['analysis_stage'] }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    {% endif %}

  </div>
{% endblock %}